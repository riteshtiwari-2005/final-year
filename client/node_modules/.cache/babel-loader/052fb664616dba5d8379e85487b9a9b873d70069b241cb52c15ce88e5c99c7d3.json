{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { userRequest } from \"../Utils/requestMethods\";\nimport AES from \"crypto-js/aes\";\nimport Cookies from \"js-cookie\";\n// import encUtf8 from \"crypto-js/enc-utf8\";\n//ON A REAL PROJECT, THIS WOULD BE USED WITH .ENV, IN ORDER TO HAVE SECURITY\n//AND NO ONE HAVE ACCES TO THE SECRET PHRASE OF THE CART\nconst cookieOptions = {\n  expires: 7\n};\nvar secretCart = process.env.REACT_APP_CART_SECRET;\nconst cartRedux = createSlice({\n  name: \"cart\",\n  initialState: {\n    items: [],\n    totalAmount: 0,\n    userId: null\n  },\n  reducers: {\n    addItemToCartHandler(state, action) {\n      const newItem = action.payload;\n      const user = newItem.user;\n      // console.log(user);\n      const newTotalAmount = state.totalAmount + newItem.price * newItem.amount;\n      //   console.log(newTotalAmount);\n      const existingItem = state.items.find(item => item.id === newItem.id);\n      //   state.items.amount = 0;\n      if (!existingItem) {\n        state.items.push({\n          id: newItem.id,\n          name: newItem.name,\n          amount: newItem.amount || 1,\n          price: newItem.price,\n          img: newItem.img\n        });\n        state.totalAmount = newTotalAmount;\n      } else {\n        existingItem.amount = existingItem.amount + newItem.amount;\n        state.totalAmount = newTotalAmount;\n      }\n      //BEING IMPLEMENTED... IN PROGRESS\n      if (user !== null) {\n        userRequest.put(`/users/userUpdate/${user}`, {\n          cart: state.items,\n          cartTotalAmount: state.totalAmount\n        });\n        Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\n      } else {\n        const encryptedCart = AES.encrypt(JSON.stringify({\n          cart: state.items,\n          cartTotalAmount: state.totalAmount\n        }), secretCart).toString();\n        Cookies.set(\"encryptedData\", encryptedCart, cookieOptions);\n      }\n    },\n    updateCartHandler(state, action) {\n      state.items = action.payload.items;\n      state.totalAmount = action.payload.totalAmount;\n      // console.log(action.payload.userId);\n      if (action.payload.userId !== null) {\n        userRequest.put(`/users/userUpdate/${action.payload.userId}`, {\n          cart: state.items,\n          cartTotalAmount: state.totalAmount\n        });\n      }\n    },\n    removeItemFromCart(state, action) {\n      const id = action.payload.id;\n      const user = action.payload.user;\n      const existingItem = state.items.find(item => item.id === id);\n      //   console.log(existingItem.price);\n      if (existingItem.amount === 1) {\n        state.items = state.items.filter(item => item.id !== id);\n        state.totalAmount = state.totalAmount - existingItem.price;\n      } else {\n        existingItem.amount--;\n        state.totalAmount = state.totalAmount - existingItem.price;\n      }\n      if (user !== null) {\n        userRequest.put(`/users/userUpdate/${user}`, {\n          cart: state.items,\n          cartTotalAmount: state.totalAmount\n        });\n        Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\n      } else {\n        const encryptedCart = AES.encrypt(JSON.stringify({\n          cart: state.items,\n          cartTotalAmount: state.totalAmount\n        }), secretCart).toString();\n        Cookies.set(\"encryptedData\", encryptedCart, cookieOptions);\n        state.items.length === 0 && Cookies.remove(\"encryptedData\");\n        // console.log(state.items.length);\n      }\n    },\n\n    removeFromDB(state, action) {\n      const user = action.payload;\n      if (user !== null) {\n        userRequest.put(`/users/userUpdate/${user}`, {\n          cart: [],\n          cartTotalAmount: 0\n        });\n      }\n      state.items = [];\n      state.totalAmount = 0;\n      Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\n    },\n    clearCartHandler(state, action) {\n      const item = action.payload;\n      Cookies.remove(\"encryptedData\");\n      return state = item;\n    }\n  }\n});\nexport const cartActions = cartRedux.actions;\nexport default cartRedux;","map":{"version":3,"names":["createSlice","userRequest","AES","Cookies","cookieOptions","expires","secretCart","process","env","REACT_APP_CART_SECRET","cartRedux","name","initialState","items","totalAmount","userId","reducers","addItemToCartHandler","state","action","newItem","payload","user","newTotalAmount","price","amount","existingItem","find","item","id","push","img","put","cart","cartTotalAmount","get","remove","encryptedCart","encrypt","JSON","stringify","toString","set","updateCartHandler","removeItemFromCart","filter","length","removeFromDB","clearCartHandler","cartActions","actions"],"sources":["D:/finalyear-2/Ger-s-Garage/client/src/Redux/cartRedux.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\nimport { userRequest } from \"../Utils/requestMethods\";\r\nimport AES from \"crypto-js/aes\";\r\nimport Cookies from \"js-cookie\";\r\n// import encUtf8 from \"crypto-js/enc-utf8\";\r\n//ON A REAL PROJECT, THIS WOULD BE USED WITH .ENV, IN ORDER TO HAVE SECURITY\r\n//AND NO ONE HAVE ACCES TO THE SECRET PHRASE OF THE CART\r\nconst cookieOptions = { expires: 7 };\r\nvar secretCart = process.env.REACT_APP_CART_SECRET;\r\n\r\nconst cartRedux = createSlice({\r\n  name: \"cart\",\r\n  initialState: {\r\n    items: [],\r\n    totalAmount: 0,\r\n    userId: null,\r\n  },\r\n  reducers: {\r\n    addItemToCartHandler(state, action) {\r\n      const newItem = action.payload;\r\n      const user = newItem.user;\r\n      // console.log(user);\r\n      const newTotalAmount = state.totalAmount + newItem.price * newItem.amount;\r\n      //   console.log(newTotalAmount);\r\n      const existingItem = state.items.find((item) => item.id === newItem.id);\r\n      //   state.items.amount = 0;\r\n      if (!existingItem) {\r\n        state.items.push({\r\n          id: newItem.id,\r\n          name: newItem.name,\r\n          amount: newItem.amount || 1,\r\n          price: newItem.price,\r\n          img: newItem.img,\r\n        });\r\n        state.totalAmount = newTotalAmount;\r\n      } else {\r\n        existingItem.amount = existingItem.amount + newItem.amount;\r\n        state.totalAmount = newTotalAmount;\r\n      }\r\n      //BEING IMPLEMENTED... IN PROGRESS\r\n      if (user !== null) {\r\n        userRequest.put(`/users/userUpdate/${user}`, {\r\n          cart: state.items,\r\n          cartTotalAmount: state.totalAmount,\r\n        });\r\n        Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\r\n      } else {\r\n        const encryptedCart = AES.encrypt(\r\n          JSON.stringify({\r\n            cart: state.items,\r\n            cartTotalAmount: state.totalAmount,\r\n          }),\r\n          secretCart\r\n        ).toString();\r\n        Cookies.set(\"encryptedData\", encryptedCart, cookieOptions);\r\n      }\r\n    },\r\n    updateCartHandler(state, action) {\r\n      state.items = action.payload.items;\r\n      state.totalAmount = action.payload.totalAmount;\r\n      // console.log(action.payload.userId);\r\n      if (action.payload.userId !== null) {\r\n        userRequest.put(`/users/userUpdate/${action.payload.userId}`, {\r\n          cart: state.items,\r\n          cartTotalAmount: state.totalAmount,\r\n        });\r\n      }\r\n    },\r\n    removeItemFromCart(state, action) {\r\n      const id = action.payload.id;\r\n      const user = action.payload.user;\r\n      const existingItem = state.items.find((item) => item.id === id);\r\n      //   console.log(existingItem.price);\r\n      if (existingItem.amount === 1) {\r\n        state.items = state.items.filter((item) => item.id !== id);\r\n        state.totalAmount = state.totalAmount - existingItem.price;\r\n      } else {\r\n        existingItem.amount--;\r\n        state.totalAmount = state.totalAmount - existingItem.price;\r\n      }\r\n      if (user !== null) {\r\n        userRequest.put(`/users/userUpdate/${user}`, {\r\n          cart: state.items,\r\n          cartTotalAmount: state.totalAmount,\r\n        });\r\n        Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\r\n      } else {\r\n        const encryptedCart = AES.encrypt(\r\n          JSON.stringify({\r\n            cart: state.items,\r\n            cartTotalAmount: state.totalAmount,\r\n          }),\r\n          secretCart\r\n        ).toString();\r\n        Cookies.set(\"encryptedData\", encryptedCart, cookieOptions);\r\n        state.items.length === 0 && Cookies.remove(\"encryptedData\");\r\n        // console.log(state.items.length);\r\n      }\r\n    },\r\n    removeFromDB(state, action) {\r\n      const user = action.payload;\r\n      if (user !== null) {\r\n        userRequest.put(`/users/userUpdate/${user}`, {\r\n          cart: [],\r\n          cartTotalAmount: 0,\r\n        });\r\n      }\r\n      state.items = [];\r\n      state.totalAmount = 0;\r\n      Cookies.get(\"encryptedData\") && Cookies.remove(\"encryptedData\");\r\n    },\r\n    clearCartHandler(state, action) {\r\n      const item = action.payload;\r\n      Cookies.remove(\"encryptedData\");\r\n      return (state = item);\r\n    },\r\n  },\r\n});\r\n\r\nexport const cartActions = cartRedux.actions;\r\n\r\nexport default cartRedux;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}